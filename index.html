<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speed RPS - v26.6</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; overflow: hidden; background: #f3e5f5; font-family: sans-serif; touch-action: none; position: fixed; width: 100%; height: 100%; }
        
        /* Â∫ÉÂëäÊû†Ôºö150px (ÂÖ±ÈÄö‰ªïÊßò) */
        #ad-top, #ad-bottom { position: fixed; left: 0; width: 100%; height: 150px; background: #333; z-index: 100; display: flex; align-items: center; justify-content: center; }
        #ad-top { top: 0; border-bottom: 1px solid #444; } 
        #ad-bottom { bottom: 0; border-top: 1px solid #444; }
        iframe { border: none; width: 100%; height: 150px; background: #333; }

        /* „Ç≤„Éº„É†Êú¨‰Ωì„Ç®„É™„Ç¢ */
        #game-outer { position: absolute; top: 150px; bottom: 150px; left: 0; right: 0; background: #f3e5f5; overflow: hidden; }
        #game-area { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 10px; }
        
        #ui { position: absolute; top: 5px; width: 100%; text-align: center; color: #7b1fa2; font-size: 20px; font-weight: bold; z-index: 10; }
        #instruction { font-size: 28px; font-weight: bold; color: #7b1fa2; background: white; padding: 8px 15px; border-radius: 10px; box-shadow: 0 4px #ce93d8; }
        #enemy-hand { font-size: 80px; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        
        .btn-group { display: flex; gap: 12px; }
        .hand-btn { 
            width: 85px; height: 85px; font-size: 40px; border: none; border-radius: 20px; 
            background: white; box-shadow: 0 5px #ba68c8; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            -webkit-tap-highlight-color: transparent;
        }
        .hand-btn:active { transform: translateY(3px); box-shadow: 0 2px #ba68c8; }

        /* „É°„Éã„É•„ÉºÁîªÈù¢ */
        #menuScreen { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(255,255,255,0.96); display: flex; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 200; padding: 20px 0;
        }

        /* ‰∏≠Â§ÆÂ∫ÉÂëäÔºài-mobileÔºâ */
        #ad-middle-container { 
            width: 320px; height: 100px; background: #eee; margin: 15px 0; 
            display: none; justify-content: center; align-items: center; 
            overflow: hidden; flex-shrink: 0; border: 1px solid #ddd;
            transition: opacity 0.3s;
        }

        .menu-btn-group { display: flex; flex-direction: column; align-items: center; width: 100%; gap: 12px; }
        .menu-btn { width: 240px; padding: 15px; font-size: 18px; border: none; border-radius: 50px; font-weight: bold; cursor: pointer; text-decoration: none; text-align: center; transition: 0.2s; }
        #retry-btn { background: #9c27b0; color: white; box-shadow: 0 4px #7b1fa2; }
        #retry-btn:disabled { background: #ccc; box-shadow: none; color: #888; cursor: default; }
        #more-games-btn { background: #ff4081; color: white; box-shadow: 0 4px #c2185b; }

        /* Â§ßÂ∫ÉÂëäÁî®„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥‰ªò„Åç */
        #bigAdScreen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 3000; display: none; justify-content: center; align-items: center; }
        .ad-frame-wrapper { width: 95%; height: 85%; position: relative; }
        .ad-close-btn { 
            position: absolute; top: -15px; right: -15px; 
            color: white; font-size: 22px; font-weight: bold; 
            cursor: pointer; background: rgba(0,0,0,0.8); 
            width: 44px; height: 44px; border-radius: 50%; 
            display: none; align-items: center; justify-content: center; 
            z-index: 3100; border: 2px solid white; font-family: sans-serif;
        }
    </style>
</head>
<body>

    <div id="ad-top"><iframe id="frame-top" src="./ad.html?pos=top"></iframe></div>

    <div id="game-outer">
        <div id="ui">SCORE: 0</div>
        
        <div id="game-area">
            <div id="instruction">ÊåáÁ§∫ÂæÖ„Å°</div>
            <div id="enemy-hand">‚ùî</div>
            <div class="btn-group">
                <button class="hand-btn" onpointerdown="checkAnswer('‚úä')">‚úä</button>
                <button class="hand-btn" onpointerdown="checkAnswer('‚úåÔ∏è')">‚úåÔ∏è</button>
                <button class="hand-btn" onpointerdown="checkAnswer('‚úã')">‚úã</button>
            </div>
        </div>

        <div id="menuScreen">
            <h2 id="result-msg" style="color:#7b1fa2; margin: 10px 0; font-size: 26px; text-align: center;">„ÅÇ„Å®„Å†„Åó„Ç∏„É£„É≥„Ç±„É≥</h2>
            <p id="menuDesc" style="font-size: 14px; color: #666; margin: 0 0 10px 0;">ÊåáÁ§∫„Å´Âêà„Çè„Åõ„Å¶Êâã„ÇíÈÅ∏„Çì„Åß„Å≠ÔºÅ</p>
            
            <div id="ad-middle-container">
                <div id="im-8b492cea6667490da71c488bdcc7cfc8">
                    <script async src="https://imp-adedge.i-mobile.co.jp/script/v1/spot.js?20220104"></script>
                    <script>(window.adsbyimobile=window.adsbyimobile||[]).push({pid:84561,mid:590804,asid:1924211,type:"banner",display:"inline",elementid:"im-8b492cea6667490da71c488bdcc7cfc8"})</script>
                </div>
            </div>

            <div class="menu-btn-group">
                <button id="retry-btn" class="menu-btn" onclick="startNewGame()">„Çπ„Çø„Éº„ÉàÔºÅ</button>
                <a href="https://saaaachi.github.io/" id="more-games-btn" class="menu-btn">‰ªñ„ÅÆ„Ç≤„Éº„É†„ÅØ„Åì„Å°„Çâ</a>
            </div>
        </div>

        <div id="bigAdScreen">
            <div class="ad-frame-wrapper">
                <div id="ad-close-btn" class="ad-close-btn" onclick="closeBigAd()"></div>
                <iframe id="ad-large-frame" src="" style="width:100%; height:100%; border:none;"></iframe>
            </div>
        </div>
    </div>

    <div id="ad-bottom"><iframe id="frame-bottom" src="./ad.html?pos=bottom"></iframe></div>

    <script>
        const hands = ['‚úä', '‚úåÔ∏è', '‚úã'];
        const insts = ['Âãù„Å£„Å¶ÔºÅ', 'Ë≤†„Åë„Å¶ÔºÅ'];
        let currentHand, currentInst, score = 0, gameActive = false, timer, playCount = 0;

        const menuScreen = document.getElementById("menuScreen");
        const adMid = document.getElementById("ad-middle-container");
        const resultMsg = document.getElementById("result-msg");
        const retryBtn = document.getElementById("retry-btn");

        function startNewGame() {
            menuScreen.style.display = "none";
            adMid.style.display = "none";
            gameActive = true; 
            score = 0; 
            document.getElementById("ui").innerText = "SCORE: 0";
            nextQuestion();
        }

        function nextQuestion() {
            if(!gameActive) return;
            currentHand = hands[Math.floor(Math.random()*3)];
            currentInst = insts[Math.floor(Math.random()*2)];
            document.getElementById("enemy-hand").innerText = currentHand;
            document.getElementById("instruction").innerText = currentInst;
            
            clearTimeout(timer);
            // Èõ£ÊòìÂ∫¶Ë™øÊï¥Ôºö1.8Áßí„Åã„ÇâÂæê„ÄÖ„Å´Áü≠Á∏ÆÔºàÊúÄ‰Ωé0.65ÁßíÔºâ
            timer = setTimeout(() => { gameOver("ÊôÇÈñìÂàá„ÇåÔºÅ‚è≥"); }, Math.max(650, 1800 - score * 60));
        }

        function checkAnswer(playerHand) {
            if(!gameActive) return;
            let result; // 0:„ÅÇ„ÅÑ„Åì, 1:Âãù„Å°, 2:Ë≤†„Åë
            if(playerHand === currentHand) result = 0;
            else if((playerHand==='‚úä'&&currentHand==='‚úåÔ∏è')||(playerHand==='‚úåÔ∏è'&&currentHand==='‚úã')||(playerHand==='‚úã'&&currentHand==='‚úä')) result = 1;
            else result = 2;

            const isCorrect = (currentInst === 'Âãù„Å£„Å¶ÔºÅ' && result === 1) || (currentInst === 'Ë≤†„Åë„Å¶ÔºÅ' && result === 2);
            if(isCorrect) { 
                score++; 
                document.getElementById("ui").innerText = "SCORE: " + score;
                nextQuestion(); 
            } else { 
                gameOver("„Åæ„Å°„Åå„ÅÑÔºÅüò±"); 
            }
        }

        function gameOver(msg) { 
            gameActive = false; 
            playCount++;
            clearTimeout(timer);

            // --- ‚ú® Ë™§„Çø„ÉÉ„ÉóÈò≤Ê≠¢„Ç¨„Éº„ÉâÁô∫Âãï (1.5Áßí) ---
            retryBtn.innerText = "„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ...";
            retryBtn.disabled = true;
            adMid.style.display = "flex";
            adMid.style.pointerEvents = "none";
            adMid.style.opacity = "0.4";

            resultMsg.innerText = msg;
            document.getElementById("menuDesc").innerText = "SCORE: " + score;
            menuScreen.style.display = "flex";

            setTimeout(() => {
                adMid.style.pointerEvents = "auto";
                adMid.style.opacity = "1";
                retryBtn.disabled = false;
                retryBtn.innerText = "„ÇÇ„ÅÜ‰∏ÄÂ∫¶ÈÅä„Å∂";
            }, 1500);

            // Â§ßÂ∫ÉÂëäÂà§ÂÆöÔºà3ÂõûÁõÆ„ÄÅ‰ª•Èôç7Âõû„Åî„Å®Ôºâ
            if (playCount === 3 || (playCount > 3 && (playCount - 3) % 7 === 0)) {
                setTimeout(showBigAd, 500);
            }
        }

        function showBigAd() {
            const screen = document.getElementById("bigAdScreen");
            const closeBtn = document.getElementById("ad-close-btn");
            document.getElementById("ad-large-frame").src = "./ad.large.html?t=" + Date.now();
            screen.style.display = "flex";
            
            let countdown = 5;
            closeBtn.style.display = "flex";
            closeBtn.innerText = countdown;
            closeBtn.style.pointerEvents = "none";
            closeBtn.style.opacity = "0.7";

            const timerInt = setInterval(() => {
                countdown--;
                closeBtn.innerText = countdown;
                if (countdown <= 0) {
                    clearInterval(timerInt);
                    closeBtn.innerText = "√ó";
                    closeBtn.style.pointerEvents = "auto";
                    closeBtn.style.opacity = "1";
                }
            }, 1000);
        }

        function closeBigAd() {
            document.getElementById("bigAdScreen").style.display = "none";
            document.getElementById("ad-large-frame").src = "";
        }

        // Â∫ÉÂëä„É™„Éï„É¨„ÉÉ„Ç∑„É• (30Áßí‰∫§‰∫í)
        setInterval(() => {
            const f = document.getElementById('frame-top');
            if(f) f.src = "./ad.html?pos=top&t=" + Date.now();
        }, 30000);
        setTimeout(() => {
            setInterval(() => {
                const f = document.getElementById('frame-bottom');
                if(f) f.src = "./ad.html?pos=bottom&t=" + Date.now();
            }, 30000);
        }, 15000);

        window.onload = () => { menuScreen.style.display = "flex"; };
    </script>
</body>
</html>
